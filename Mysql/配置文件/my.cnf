#主数据库my.cnf
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html

[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M
socket=/var/lib/mysql/mysql.sock

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

########basic settings########
## 每个节点的server-id一定要设置不同
server-id = 1
port = 3306
user = mysql
bind_address = 0.0.0.0
skip_name_resolve = 1
## 指定数据文件路径
datadir = /data/mysql
character-set-server=utf8
lower_case_table_names=1
transaction-isolation=READ-COMMITTED
sql_mode=STRICT_TRANS_TABLES,NO_AUTO_VALUE_ON_ZERO,NO_ZERO_IN_DATE,NO_ZERO_DATE
max_connections=1000
max_connect_errors=10000
innodb_buffer_pool_size=10G
back_log=900
open_files_limit=102400
thread_cache_size=128
table_open_cache=1024
innodb_buffer_pool_instances=4
innodb_flush_method=O_DIRECT
innodb_log_file_size=1073741824
max_allowed_packet = 256M
########replication settings########
master_info_repository = TABLE
relay_log_info_repository = TABLE
## MySQL复制是基于binlog日志的
log_bin = master-bin
sync_binlog = 1
log_slave_updates
binlog_format = row
relay_log = relay.log
relay_log_recovery = 1
slave_skip_errors = ddl_exist_errors
binlog_format = mixed
binlog-do-db = srm
auto-increment-increment = 2
auto-increment-offset = 1
log_bin_trust_function_creators = 1
expire_logs_days = 3
#######semi sync replication settings########
## 设置插件目录路径
plugin_dir=/usr/lib64/mysql/plugin
## 加载插件
plugin_load = "rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so"
## 开启master semi sync replication
rpl_semi_sync_master_enabled = 1
## 开启slave semi sync replication
rpl_semi_sync_slave_enabled = 1
## 等待5秒无ack应答自动切换为异步模式
rpl_semi_sync_master_timeout = 5000
## 开启lossless replication
rpl_semi_sync_master_wait_point= AFTER_SYNC
## 至少有1个slave接收到日志
rpl_semi_sync_master_wait_for_slave_count = 1

------------------------------------------------------------------------------------------

#副数据库my.cnf
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html

[mysqld]
#
# Remove leading # and set to the amount of RAM for the most important data
# cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.
# innodb_buffer_pool_size = 128M
#
# Remove leading # to turn on a very important data integrity option: logging
# changes to the binary log between backups.
# log_bin
#
# Remove leading # to set options mainly useful for reporting servers.
# The server defaults are faster for transactions and fast SELECTs.
# Adjust sizes as needed, experiment to find the optimal values.
# join_buffer_size = 128M
# sort_buffer_size = 2M
# read_rnd_buffer_size = 2M
socket=/var/lib/mysql/mysql.sock

# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0

log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

########basic settings########
## 每个节点的server-id一定要设置不同
server-id = 2
port = 3306
user = mysql
bind_address = 0.0.0.0
skip_name_resolve = 1
## 指定数据文件路径
datadir = /data/mysql
character-set-server=utf8
lower_case_table_names=1
transaction-isolation=READ-COMMITTED
sql_mode=STRICT_TRANS_TABLES,NO_AUTO_VALUE_ON_ZERO,NO_ZERO_IN_DATE,NO_ZERO_DATE
max_connections=1000
max_connect_errors=10000
innodb_buffer_pool_size=10G
back_log=900
open_files_limit=102400
thread_cache_size=128
table_open_cache=1024
innodb_buffer_pool_instances=4
innodb_flush_method=O_DIRECT
innodb_log_file_size=1073741824
innodb_flush_log_at_trx_commit = 0
replicate-do-db = srm
max_allowed_packet = 256M
########replication settings########
master_info_repository = TABLE
relay_log_info_repository = TABLE
## MySQL复制是基于binlog日志的
log_bin = master-bin
sync_binlog = 0
log_slave_updates
binlog_format = row
relay_log = relay.log
relay_log_recovery = 1
slave_skip_errors = ddl_exist_errors
binlog_format = mixed
auto-increment-increment = 2
auto-increment-offset = 1
slave-net-timeout = 60
log_bin_trust_function_creators = 1
expire_logs_days = 3
#######semi sync replication settings########
## 设置插件目录路径
plugin_dir=/usr/lib64/mysql/plugin
## 加载插件
plugin_load = "rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so"
## 开启master semi sync replication
rpl_semi_sync_master_enabled = 1
## 开启slave semi sync replication
rpl_semi_sync_slave_enabled = 1
## 等待5秒无ack应答自动切换为异步模式
rpl_semi_sync_master_timeout = 5000
## 开启lossless replication
rpl_semi_sync_master_wait_point= AFTER_SYNC
## 至少有1个slave接收到日志
rpl_semi_sync_master_wait_for_slave_count = 1

